<div id="section-{{ section.id }}" class="site-box-container image-container container--fullscreen">
  {%- if section.settings.link != blank -%}
    <a href="{{ section.settings.link }}" {% if section.settings.target %} target="_blank" {% endif %}>
  {%- endif -%}

    {%- unless section.settings.image == blank -%}
      {%- assign image = section.settings.image -%}

      <div class="blank-image" style="height: 100vh; overflow: hidden;">
        <div class="scene" style="height: 100%; perspective: none;">
          <div style="perspective: 50px;" class="cube">
              <!-- Apply perspective effect to the image -->
              <img
                src="{{ image | image_url: width: 640 }}" alt="{{ image.alt | strip_html | escape }}"
                srcset="{{ image | image_url: width: 320 }} 320w, {{ image | image_url: width: 480 }} 480w, {{ image | image_url: width: 640 }} 640w, {{ image | image_url: width: 840 }} 840w, {{ image | image_url: width: 1080 }} 1080w, {{ image | image_url: width: 1280 }} 1280w, {{ image | image_url: width: 1540 }} 1540w, {{ image | image_url: width: 1860 }} 1860w, {{ image | image_url: width: 2100 }} 2100w"
                sizes="100vw"
                width="{{ image.width }}" height="{{ image.height }}"
                {% unless preload %} loading="lazy" {% endunless %} class="lazy cube__image"
                onload="this.classList.add('lazyloaded')"
                style="width: 100%; height: 100vh; object-fit: cover; transform: translateY(0) translateZ(0); transition: transform 0.3s ease;"
              />
                  <div class="cube__face cube__face--right">right</div>
    <div class="cube__face cube__face--left">left</div>
    <div class="cube__face cube__face--top">top</div>
    <div class="cube__face cube__face--bottom">bottom</div>
            </div>
        </div>
      </div>

    {%- else -%}
      <div class="box__blank-image" style="height: 100vh; overflow: hidden;">
        <span class="onboarding-svg section--image-text--item__image onboarding-background">
          {{ 'image' | placeholder_svg_tag }}
        </span>
      </div>
    {%- endunless -%}

  {%- if section.settings.link != blank -%} </a> {%- endif -%}
</div>

<script>
  var scene = document.querySelector('.scene');
  var imageContainer = document.querySelector('.cube__image');
  var isSticky = true;

  function updateTransformOnScroll() {
    var scrollPosition = window.scrollY || window.pageYOffset;
    var translateY = Math.max(0, Math.min(scrollPosition, 400)); // Limit translateY between 0 and 400
    var translateZ = -Math.max(0, Math.min(scrollPosition, 400)); // Limit translateZ between 0 and -400
    
    imageContainer.style.transform = 'translateY(' + translateY + 'px) translateZ(' + translateZ + 'px)';
  }

  function updatePerspectiveOnScroll() {
    var scrollPosition = window.scrollY || window.pageYOffset;
    var perspectiveValue = Math.min(scrollPosition, 200);
    
    scene.style.perspective = perspectiveValue + 'px';

    if (perspectiveValue >= 200 && isSticky) {
      document.getElementById("section-{{ section.id }}").style.position = 'static';
      isSticky = false;
    } else if (perspectiveValue < 200 && !isSticky) {
      document.getElementById("section-{{ section.id }}").style.position = 'sticky';
      isSticky = true;
    }
  }

  window.addEventListener('scroll', function() {
    updatePerspectiveOnScroll();
    updateTransformOnScroll();
  });
  
  scene.style.perspective = 'none'; // Initial perspective setting
</script>

{% schema %}
  {
    "name": "Perspective Image",
    "class": "index-section",
    "settings": [
      {
        "type": "image_picker",
        "id": "image",
        "label": "t:sections.image.name"
      },
      {
        "type": "url",
        "id": "link",
        "label": "t:sections.local-extra-words.sections.announcement-bar.blocks.content.settings.link"
      },
      {
        "type": "checkbox",
        "id": "target",
        "label": "t:sections.local-extra-words.sections.announcement-bar.blocks.content.settings.target",
        "default": false
      }
    ], 
    "presets": [
      {
        "name": "Perspective Image"
      }
    ],
    "disabled_on": {
      "groups": ["custom.overlay", "header"]
    }
  }
{% endschema %}
